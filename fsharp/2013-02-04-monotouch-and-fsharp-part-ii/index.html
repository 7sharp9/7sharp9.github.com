<!doctype html><html><head><title>MonoTouch and F# part II &#183; 7sharp9</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.82.1"><link rel=stylesheet href=https://7sharp9.dev/css/vec.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.ico><link href rel=alternate type=application/rss+xml title=7sharp9></head><body><header><nav><ul><li class=pull-left><a href=https://7sharp9.dev/>/Home</a></li><li class=pull-left><a href=/about>/About</a></li><li class=pull-left><a href=/fsharp>/F#</a></li><li class=pull-left><a href=/running>/Running</a></li><li class=pull-left><a href=/elm>/Elm</a></li><li class=pull-right><a href><i class="fas fa-rss"></i></a></li></ul></nav></header><div class="content wide"><section class=post><h1 class=post-title><a href=https://7sharp9.dev/fsharp/2013-02-04-monotouch-and-fsharp-part-ii/>MonoTouch and F# part II</a></h1><span class=post-date>Feb 7, 2013</span><div class=post-content><p>In the last post we left at the point where everything was running fine and dandy on the Simulator. So what happens if we compile for the real hardware?</p><p>Lets change the active configuration to <code>Debug|iPhone</code> and hit build, what do we get?</p><h3 id=boom>Boom!</h3><p><em>Error MT2002: Could not resolve: FSharp.Core, Version=4.3.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a (MT2002) (singleview)</em></p><p>So I guess we need to tell it where the FSharp.Core.dll is, lets add a reference to it:</p><pre><code>/Libraries/FrameWorks/Mono.FrameWork/Libraries/mono/Microsoft F#/v4.0/Fsharp.Core.dll
</code></pre><p>Now try and build &mldr; another weird error:</p><p><em>unknown-file(1,1): Error FS2020: The assembly &lsquo;F#/v4.0/FSharp.Core.dll&rsquo; is listed on the command line. Assemblies should be referenced using a command line flag such as &lsquo;-r&rsquo;. (FS2020) (singleview)</em></p><p>Hmmm, lets look in the F# compiler source, were going to have to break out the big guns for this one.</p><p>What we need to do is look at the different targets that are available. I remember seeing different targets when I was nosing through the source files a while ago. Also if you look at the <code>readme.md</code> file that comes with the open source compiler:</p><p>You can also build FSharp.Core for: .NET 2.0, Mono 2.1, Silverlight 5.0, Portable Profile47 (net4+sl4+wp71+win8) and XNA 4.0 for Xbox 360 profiles:</p><pre><code>msbuild fsharp-library-build.proj /p:TargetFramework=net20 
msbuild fsharp-library-build.proj /p:TargetFramework=mono21
msbuild fsharp-library-build.proj /p:TargetFramework=portable-net4+sl4+wp71+win8
msbuild fsharp-library-build.proj /p:TargetFramework=sl5
msbuild fsharp-library-build.proj /p:TargetFramework=net40-xna40-xbox360
</code></pre><p>So lets build the <code>mono21</code> target with <code>xbuild</code>:</p><pre><code>xbuild fsharp-library-build.proj /p:TargetFramework=mono21
</code></pre><p>Now that&rsquo;s build lets reference the output and see what happens:</p><p>Arrgh another error this time relating the the version of the framework that we have compiled against.</p><p>If you read the documentation for <a href=http://xamarin.com/monotouch>MonoTouch</a> in a little more detail you will discover that a different mscorlib is required. We need to modify this in the build script:</p><p>Open up <code>FSharp.Source.Targets</code> and find the <code>&lt;PropertyGroup Condition="'$(TargetFramework)'=='mono21'"></code> section, add the following after the <code>&lt;DefineConstants></code> elements.</p><pre><code>&lt;OtherFlags&gt;$(OtherFlags) --simpleresolution -r:&quot;/Developer/MonoTouch/usr/lib/mono/2.1/mscorlib-runtime.dll&quot;  &lt;/OtherFlags&gt;
</code></pre><p>Right, fingers crossed&mldr;</p><p>Sigh, another error:</p><p><em>Error MT2002: Can not resolve reference: System.Reflection.Emit.AssemblyBuilder (MT2002) (singleview)</em></p><p>Were getting closer though.</p><p>Lets look at the <code>&lt;DefineConstants/></code> that are declared in the build file, if you have a quick look you will notice that there is one called <code>FX_NO_REFLECTION_EMIT</code> that&rsquo;s what we need so that <code>Reflection.Emit</code> is not included. MonoTouch does not support <code>Reflection.Emit</code> due to the meta data not being available once the code have been compiled with the <a href=http://www.mono-project.com/AOT>AOT compiler</a>.</p><p>Lets add that constant to the end of the rest:</p><pre><code>&lt;DefineConstants&gt;$(DefineConstants);FX_NO_REFLECTION_EMIT&lt;/DefineConstants&gt;
</code></pre><p>If we rebuild <code>Fsharp.Core</code> again with <code>xbuild</code> and rebind the reference in our test project&mldr;</p><h3 id=wow-it-works>Wow it works!</h3><p>You should now have a working hello world application that can be deployed and run on real hardware.</p><h2 id=final-words>Final Words</h2><p>As this is just a documented hackathon I have mainly brain dumped what I remembered doing after the fact, so some steps may be slightly different. As soon as time permits Ill be adding a couple of project templates to the <a href=https://github.com/fsharp/fsharpbinding>FSharpBinding</a> to allow building F# MonoTouch libraries and applications.</p><p>I also have some ideas for dealing with the UI and tooling with <a href=https://developer.apple.com/technologies/tools/>Xcode</a> but Ill need a little time to investigate to see if it&rsquo;s a viable option&mldr;</p><p>Until next time!</p></div></section><section class="pagination clearfix"><a class="btn previous" href=https://7sharp9.dev/fsharp/2013-02-03-monotouch-and-fsharp-part-i/>MonoTouch and F# part I</a>
<a class="btn next" href=https://7sharp9.dev/fsharp/2013-04-16-a-little-bit-of-ios-async/>A little bit of iOS async</a></section><section id=disqus_thread class=disqus></section><script>var disqus_config=function(){this.page.url="https://7sharp9.dev/fsharp/2013-02-04-monotouch-and-fsharp-part-ii/"};(function(){var a=document,b=a.createElement('script');b.src='//7sharp9.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div><footer><div class="footer-info pull-right">Â© 2021 Dave Thomas</div></footer><script src=https://7sharp9.dev/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-10152365-8','auto'),ga('send','pageview')</script></body></html>