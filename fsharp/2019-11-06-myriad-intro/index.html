<!doctype html><html><head><title>Myriad Intro &#183; 7sharp9</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.82.1"><link rel=stylesheet href=https://7sharp9.dev/css/vec.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.ico><link href rel=alternate type=application/rss+xml title=7sharp9></head><body><header><nav><ul><li class=pull-left><a href=https://7sharp9.dev/>/Home</a></li><li class=pull-left><a href=/about>/About</a></li><li class=pull-left><a href=/fsharp>/F#</a></li><li class=pull-left><a href=/running>/Running</a></li><li class=pull-left><a href=/elm>/Elm</a></li><li class=pull-right><a href><i class="fas fa-rss"></i></a></li></ul></nav></header><div class="content wide"><section class=post><h1 class=post-title><a href=https://7sharp9.dev/fsharp/2019-11-06-myriad-intro/>Myriad Intro</a></h1><span class=post-date>Nov 6, 2019</span><div class=post-content><p>I released a new meta programming club <a href=https://youtu.be/Yef8EJJfd9Q>video</a> yesterday on my YouTube <a href=https://www.youtube.com/channel/UC0kXc1f_WBYSklrElcPWzgg>channel</a></p><p>I thought I would write a little about it here on my blog.</p><p>I recently did a little work to flesh out the plugin interface for Myriad. My friend <a href=https://twitter.com/enricosada>Enrico Sada</a> helped out with
some of the fiddly MsBuild work in dotnet which can be a little confusing at times.</p><p>The gist of the plugin is that you must implement the following interface:</p><pre><code>type IMyriadGenerator =
    abstract member Generate: namespace': string * ast:ParsedInput -&gt; SynModuleOrNamespaceRcd
</code></pre><p>And annotate you type with the <code>MyriadGeneratorAttribute</code> specifying the name of your plugin so that it can be found.<br>Heres an example plugin from the <a href=https://github.com/MoiraeSoftware/myriad>Myriad repo</a>:</p><pre><code>[&lt;MyriadGenerator(&quot;example1&quot;)&gt;]
type Example1Gen() =
    interface IMyriadGenerator with
        member __.Generate(namespace', _ast) =

            let let42 =
                SynModuleDecl.CreateLet
                    [ { SynBindingRcd.Let with
                            Pattern = SynPatRcd.CreateLongIdent(LongIdentWithDots.CreateString &quot;fourtyTwo&quot;, [])
                            Expr = SynExpr.CreateConst(SynConst.Int32 42) } ]

            let componentInfo = SynComponentInfoRcd.Create [ Ident.Create &quot;example1&quot; ]
            let nestedModule = SynModuleDecl.CreateNestedModule(componentInfo, [ let42 ])

            let namespaceOrModule =
                { SynModuleOrNamespaceRcd.CreateNamespace(Ident.CreateLong namespace')
                    with Declarations = [ nestedModule ] }

            namespaceOrModule
</code></pre><p>All this example does is generate a simple module like this:</p><pre><code>module example1 =
    let fourtyTwo = 42
</code></pre><h3 id=ast-helping-hand>Ast Helping Hand</h3><p>Unfortunately working with the AST can be quite verbose in Myriad I use <a href=https://github.com/ctaggart/FsAst>FsAst</a> which uses the record update syntax to aid
in the construction of AST nodes by using the record update syntax so you don&rsquo;t have to supply every parameter.</p><p>Take a Let binding AST element:</p><pre><code>{SynBindingRcd.Let with
    Pattern = pattern
    Expr = expr }
</code></pre><p>If we did not use the record update syntax in <code>SynBindingRcd</code> then we would have to supply every parameter for the let binding:</p><pre><code>{
    Access = None
    Kind = SynBindingKind.NormalBinding
    IsInline = false
    IsMutable = false
    Attributes = SynAttributes.Empty
    XmlDoc = PreXmlDoc.Empty
    ValData = SynValData(Some MemberFlags.InstanceMember, SynValInfo.Empty, None)
    Pattern = pattern
    ReturnInfo = None
    Expr = expr
    Range = range.Zero
    Bind = SequencePointInfoForBinding.NoSequencePointAtInvisibleBinding }
</code></pre><p>Which is not exactly fun, the record update syntax makes these type of things easy to define and compose together.</p><hr><p>The new version of Myriad can be found on Nuget <a href=https://www.nuget.org/packages/Myriad.Sdk/0.2.4>here</a> or at its <a href=https://github.com/MoiraeSoftware/myriad>repo</a>.</p><p>I hope you enjoyed the video and this brief blog!</p><p>Until next time!</p></div></section><section class="pagination clearfix"><a class="btn previous" href=https://7sharp9.dev/fsharp/2019-10-21-final-month-on-patreon/>Final Month On Patreon</a>
<a class="btn next" href=https://7sharp9.dev/fsharp/2019-12-03-one-year-on-youtube/>One year on YouTube</a></section></div><footer><div class="footer-info pull-right">Â© 2021 Dave Thomas</div></footer><script src=https://7sharp9.dev/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-10152365-8','auto'),ga('send','pageview')</script></body></html>