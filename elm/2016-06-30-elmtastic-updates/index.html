<!doctype html><html><head><title>Elmtastic Updates &#183; 7sharp9</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.82.1"><link rel=stylesheet href=https://7sharp9.dev/css/vec.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.ico><link href rel=alternate type=application/rss+xml title=7sharp9></head><body><header><nav><ul><li class=pull-left><a href=https://7sharp9.dev/>/Home</a></li><li class=pull-left><a href=/about>/About</a></li><li class=pull-left><a href=/fsharp>/F#</a></li><li class=pull-left><a href=/running>/Running</a></li><li class="pull-left current"><a href=/elm>/Elm</a></li><li class=pull-right><a href><i class="fas fa-rss"></i></a></li></ul></nav></header><div class="content wide"><section class=post><h1 class=post-title><a href=https://7sharp9.dev/elm/2016-06-30-elmtastic-updates/>Elmtastic Updates</a></h1><span class=post-date>Jun 30, 2016</span><div class=post-content><p>With the release of Elm 0.17 there were some fundamental changes to the Elm language. This post
is my attempt to help those that may be struggling with these changes</p><p>I&rsquo;ve played with lots of new languages over the last year or so namely Elixir, Rust, and Elm. Elm
and Elixir have been my favorites and I hope to cover those much more in this and future blog posts.</p><h1 id=so-whats-new-in-elm-017-why-do-i-need-to-upgrade-anything>So whats new in Elm 0.17 why do I need to upgrade anything?</h1><p>I&rsquo;ll summarise here:</p><ul><li>Signals have been removed (Hence some upgrade is required if you had any code using signals.)</li><li>Faster HTML renderer</li><li>Libraries for geolocation, page visibility, and web sockets</li><li>Generated JS is smaller and works with Google&rsquo;s Closure Compiler</li><li>Generated JS works with RequireJS and CommonJS</li><li>Features in place for services like GraphQL and Elixir Phoenix</li><li>Improved documentation at guide.elm-lang.org</li><li>Helpful messages when decoding JSON fails</li></ul><p>The big things are that are going to throw a spanner in the works are Signals have been removed
and the following packages have moved around:</p><pre><code>evancz/elm-html    -&gt; elm-lang/html
evancz/elm-svg     -&gt; elm-lang/svg
evancz/virtual-dom -&gt; elm-lang/virtual-dom
evancz/start-app   -&gt; elm-lang/html
evancz/elm-effects -&gt; elm-lang/core
</code></pre><p>Be sure to read the <a href=http://elm-lang.org/blog/farewell-to-frp>official post</a> on the subject for the full information.</p><h2 id=how-do-i-upgrade--are-there-any-resources-to-help>How Do I upgrade? Are there any resources to help?</h2><p>There are a few guides already that do help, the <a href=https://github.com/elm-lang/elm-platform/blob/master/upgrade-docs/0.17.md>official upgrade plan</a> is
really useful as is <a href=http://www.lambdacat.com/migrating-from-elm-0-16-to-0-17-from-startapp/>migrating from elm 0.16 to 0.17</a> and I would advise that
you read the official plan before this or any other guides. Hopefully my whistle stop
tour of upgrading an existing package may be of help.</p><h2 id=example-upgrade>Example Upgrade</h2><p>Lets take the <a href=https://github.com/Fresheyeball/elm-sprite>elm-sprite</a> package as an example, its fairly simple with only a few
dependencies.</p><h3 id=elmpackagejson>elm.package.json</h3><p>Lets look at the elm.package.json file:</p><pre><code>{
    &quot;version&quot;: &quot;1.0.0&quot;,
    &quot;summary&quot;: &quot;Simple sprite rendering for elm-html&quot;,
    &quot;repository&quot;: &quot;https://github.com/Fresheyeball/elm-sprite.git&quot;,
    &quot;license&quot;: &quot;MIT&quot;,
    &quot;source-directories&quot;: [
        &quot;src&quot;
    ],
    &quot;exposed-modules&quot;: [
        &quot;Sprite&quot;
    ],
    &quot;dependencies&quot;: {
        &quot;elm-lang/core&quot;: &quot;3.0.0 &lt;= v &lt; 4.0.0&quot;
    },
    &quot;elm-version&quot;: &quot;0.16.0 &lt;= v &lt; 0.17.0&quot;
}
</code></pre><p>We need to update the dependencies for <code>elm-lang/core</code> to <code>4.0.1 &lt;= v &lt; 5.0.0</code>
and <code>elm-version</code> to <code>0.17.0 &lt;= v &lt; 0.18.0</code>. Pretty easy in terms of dependencies.</p><h3 id=spriteelm>Sprite.elm</h3><p>This ones pretty easy, the only thing to change is the module definition which is
using an obsolete syntax:</p><pre><code>module Sprite (..) where
</code></pre><p>Now becomes</p><pre><code>module Sprite exposing (..)
</code></pre><p>Actually the Elm compiler does a fantastic job here by actually telling us what the problem is:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#a6e22e>-- SYNTAX PROBLEM --------------------------------------------------- Sprite.elm</span>

<span style=color:#a6e22e>I ran into something unexpected when parsing your code!</span>

<span style=color:#a6e22e>1| module Sprite (..) where</span>
                 <span style=color:#a6e22e>^</span>
<span style=color:#a6e22e>I am looking for one of the following things:</span>

    <span style=color:#a6e22e>something like `exposing (..)` which replaced `where` in 0.17</span>
    <span style=color:#a6e22e>whitespace</span>
</code></pre></div><p>So that was pretty painless, lets have a look at the example file: <code>One.elm</code></p><h3 id=oneelm>One.elm</h3><p>This ones a bit more tricky as there are signals involved and packages that have moved about.<br>Lets have a look at the changes needed.</p><p>First of all lets address the obsolete <code>where</code> syntax:</p><pre><code>module One exposing (..)
</code></pre><p>We need to remove the <code>Signal</code>, <code>Html.Events</code> and <code>Effects</code> imports packages, let&rsquo;s remove these:</p><pre><code>import Signal exposing (message, Address)
import Html.Events exposing (on, targetValue)
import Effects exposing (Effects, none)
</code></pre><p>Now we need to address the changes in the Time package as <code>fps</code> is no longer available, we can use milliseconds instead.</p><pre><code>import Time exposing (Time, millisecond)
</code></pre><p>Now we need to adjust the <code>StartpApp</code> import and use <code>Html.App</code> instead.</p><pre><code>import Html.App as Html
</code></pre><p>So all in all the imports section will look like this:</p><pre><code>module One exposing (..)

import Html exposing (..)
import Html.App as Html
import Time exposing (Time, millisecond)
import Html.Attributes as A
import Sprite exposing (..)
import Array
</code></pre><h3 id=action>Action</h3><p>The first thing we will tackle is the Action which flows though this application. It now looks like this:</p><pre><code>type Action
    = Tick Time
</code></pre><p>As <code>Action</code> has now been replaced with <code>Msg</code> so we need to change this to the following:</p><pre><code>type Msg
  = Tick Time
</code></pre><h3 id=init>init</h3><p>Next lets look at the init function its signature is slightly different now. <code>Html.Program</code> now <a href=http://package.elm-lang.org/packages/elm-lang/html/1.1.0/Html-App#program>starts the application</a></p><pre><code>init : (model, Cmd msg)
</code></pre><p>So rather than:</p><pre><code>init : Sprite {}
init =
   { sheet = &quot;https://10firstgames.files.wordpress.com/2012/02/actionstashhd.png&quot;
     , rows = 16
     , columns = 16
     , size = ( 2048, 2048 )
     , frame = 0
     , dope = idle
     }
</code></pre><p>It will now become:</p><pre><code>init : (Sprite {}, Cmd Msg)
init = (
  { sheet = &quot;https://10firstgames.files.wordpress.com/2012/02/actionstashhd.png&quot;
    , rows = 16
    , columns = 16
    , size = ( 2048, 2048 )
    , frame = 0
    , dope = idle
    } , Cmd.none)
</code></pre><h3 id=view>view</h3><p>This is what view looks like:</p><pre><code>view : Address Action -&gt; Sprite {} -&gt; Html
view address s =
    let
        onInput address contentToValue =
            on
                &quot;input&quot;
                targetValue
                (message address &lt;&lt; contentToValue)
    in
        div
            []
            [ node
                &quot;sprite&quot;
                [ A.style (sprite s) ]
                []
            ]
</code></pre><p>At first glance this looks a bit more complex but when you look at the code a little
more you come to realise that the <code>onInput</code> function is not even used anymore this is
just dead code. So no all that remains is to change <code>view</code> to match the new Elm 0.17
architecture, so instead of <code>Address Action -> Sprite {} -> Html</code> it will now be
<code>Sprite {} -> Html Msg</code> as <code>Address</code> and <code>Action</code> are now no longer needed.</p><pre><code>view : Sprite {} -&gt; Html Msg
view s =
  div
      []
      [
        node
          &quot;sprite&quot;
          [ A.style (sprite s)]
          []
      ]
</code></pre><h3 id=update>update</h3><p>Ok, now for <code>update</code> lets have a look at that:</p><pre><code>update : Action -&gt; Sprite {} -&gt; ( Sprite {}, Effects Action )
update action s =
    let
        s' =
            case action of
                Tick _ -&gt;
                    advance s
    in
        ( s', none )
</code></pre><p><code>update</code> now has a signature of <code>msg -> model -> (model, Cmd msg)</code> so all we really have
to do is replace <code>Action</code> with <code>Msg</code>, and <code>Effects Action</code> with <code>Cmd Msg</code>. Finally I
change the return to: <code>Cmd.none</code> which was previously <code>Effects.none</code>.</p><pre><code>update : Msg -&gt; Sprite {} -&gt; (Sprite {}, Cmd Msg)
update action s =
    let
        s' =
            case action of
                Tick _ -&gt;
                    advance s
    in
        ( s', Cmd.none )
</code></pre><h3 id=subs>subs</h3><p>This part is new, with the old 0.16 based version there was a signal which was mapping
time to a sprite update:<code>[ Signal.map Tick (fps 30) ]</code>. Now that we will be using
subscriptions this is a simple function like this:</p><pre><code>subs : Sprite {} -&gt; Sub Msg
subs model =
  Time.every (millisecond * 33) Tick
</code></pre><p>So every 33 milliseconds (30 frames per second) we are sending a Tick command to the update function.</p><h3 id=application-start>application start</h3><p>The last part is the application start, heres what it looks like in 0.16:</p><pre><code>app : StartApp.App (Sprite {})
app =
    StartApp.start
        { view = view
        , update = update
        , init = ( init, none )
        , inputs = [ Signal.map Tick (fps 30) ]
        }


main : Signal Html
main =
    app.html
</code></pre><p>You can see the <code>signal</code> I talked about above. This whole section has now become a lot simpler in Elm 0.17.</p><pre><code>main : Program Never
main =
  Html.program
    { view = view
    , update = update
    , init = init
    , subscriptions = subs
    }
</code></pre><p><code>StartApp</code> has now become <code>Html.App</code> which we aliased to <code>Html</code> at the beginning <code>import Html.App as Html</code>
and we use the <code>program</code> function to feed in all the functions we just declared.</p><p>Ok, we&rsquo;re all done, hopefully someone found this useful!</p><p>One tip I can give is to update the function signatures for each function first and it should make
things a little clearer on what you need to do.</p><p>Until next time!</p><hr></div></section><section class="pagination clearfix"><a class="btn next" href=https://7sharp9.dev/elm/2017-12-09-elmbook/>Building a single page application with Elm</a></section></div><footer><div class="footer-info pull-right">© 2021 Dave Thomas</div></footer><script src=https://7sharp9.dev/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-10152365-8','auto'),ga('send','pageview')</script></body></html>